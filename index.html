<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pose Estimation Web App</title>
    <style>
        #webcam {
            display: block;
            width: 100%;
            height: auto;
        }
        #canvas {
            position: absolute;
            top: 0;
            left: 0;
            z-index: 1;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <video id="webcam" autoplay></video>
    <canvas id="canvas"></canvas>

    <!-- Load MediaPipe Pose -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils"></script>
    
    <script>
        // Wait for MediaPipe to load
        window.onload = () => {
            // Get the video and canvas elements
            const webcam = document.getElementById('webcam');
            const canvasElement = document.getElementById('canvas');
            const canvas = canvasElement.getContext('2d');

            // Set the size of the webcam and canvas
            webcam.width = 640;
            webcam.height = 480;
            canvasElement.width = 640;
            canvasElement.height = 480;

            // Set up the webcam stream
            navigator.mediaDevices.getUserMedia({ video: true })
                .then((stream) => {
                    webcam.srcObject = stream;
                })
                .catch((error) => {
                    console.error('Webcam niet toegankelijk', error);
                });

            // Set up MediaPipe Pose for pose estimation
            const pose = new window.pose.Pose();  // Corrected initialization
            pose.setOptions({
                modelComplexity: 1,
                minDetectionConfidence: 0.5,
                minTrackingConfidence: 0.5,
            });

            // Define what happens when results are available
            pose.onResults((results) => {
                if (results.poseLandmarks) {
                    console.log('Pose Landmarks:', results.poseLandmarks);

                    // Clear the canvas before drawing new landmarks
                    canvas.clearRect(0, 0, canvasElement.width, canvasElement.height);

                    // Draw landmarks on the canvas
                    results.poseLandmarks.forEach((landmark) => {
                        const x = landmark.x * canvasElement.width;
                        const y = landmark.y * canvasElement.height;

                        // Draw a blue circle at each landmark position
                        canvas.beginPath();
                        canvas.arc(x, y, 5, 0, 2 * Math.PI);
                        canvas.fillStyle = 'blue';
                        canvas.fill();
                    });
                } else {
                    console.log('Geen pose-landmarks gevonden.');
                }
            });

            // Start the camera and send frames to MediaPipe for processing
            const camera = new window.camera.Camera(webcam, {
                onFrame: async () => {
                    await pose.send({ image: webcam });
                },
                width: 640,
                height: 480
            });

            camera.start();
        };
    </script>
</body>
</html>
